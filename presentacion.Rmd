---
title: "Opendataes"
author: "Jorge López y Jorge Cimentada"
date: "14 de noviembre de 2018"
output:
  ioslides_presentation:
    widescreen: yes
  slidy_presentation: default
  beamer_presentation: default
---
  

## Introducción (I): opendataes y datos.gob.es

- `opendataes` es un paquete que pretende interactuar con [datos.gob.es](https://datos.gob.es), un agregador de datos de instituciones públicas en España. 
- Estos datos incluyen información a nivel estatal, pero también autonómico y local.
- En total, hay disponibles alrededor de 19.000 datasets.
- `opendataes` trata de interactuar y leer datos a través la API de la web.

## Introducción (II): Limitaciones

- En los inicios del desarrollo del paquete, se ambicionó con poder leer datos de cualquier institución y casi en cualquier formato.
- Como suele ocurrir, la realidad no siempre casa con el deseo.
- Se decidió que para disponer de un *working package* tendríamos que ser conservadores y sentar las bases para que paquete vaya creciendo paulatinamente y de forma sólida.
- Ahora mismo se leen ficheros en formato *csv* y del Ayuntamiento de Barcelona, que nos permite asegurar la estandarización en el formato de los ficheros.
- Es por ello que...

## Introducción (III): Colaboración

- ¡Este paquete está plenamente abierto a colaboración! 
- Está pensado para ser desarrollado por la comunidad R. Cualquier idea, sugerencia y mejora es altamente apreciada.
- Nuestra idea es que el package paulatinamente lea archivos de más publicadores y en más formatos.

## Opendataes: workflow

<img src="opendataes_diagram.jpeg" align="center" height="550" width="955"/>

## Instalación y uso básico

- Actualmente el paquete se encuentra bajo testeo y no se puede descargar desde CRAN.

```{r, eval = TRUE, warning = FALSE, message = FALSE}
remotes::install_github("cimentadaj/opendataes")
```

- La principal función del paquete es `cargar_datos`, que permite cargar datos desde la API de [datos.gob.es](https://datos.gob.es). Esta función puede ser utilizada de dos formas:

1. Búsqueda a través de la web:

<img src="path_id.png" align="center" height="50" width="1000"/>

2. Exploración a través de R: Alternativamente, `opendataes` permite realizar la búsqueda por *keywords*. 

## Exploración a través de R (continuación)

- En primer lugar, vemos los publicadores disponibles a través del `publishers_available`. Filtramos por el Ayto. de Barcelona y exploramos los *keywords*:

```{r, echo = FALSE}
library(opendataes)
```


```{r}
pb_code <- publishers_available$publisher_code[publishers_available$publishers
                                               == 'Ayuntamiento de Barcelona']

kw <- explorar_keywords('elecciones', pb_code)
head(kw, 3)
```


## Exploración a través de R (continuación)

- Una vez tenemos el dataframe con la descripción, `cargar_datos` requiere de un dataframe con solo una fila, por lo que tendremos que seleccionar solo aquella fila que deseamos:

```{r}
final_dt <- kw[grepl("Elecciones Locales. Absolutos", kw$description), ]
elections <- cargar_datos(final_dt, encoding = 'latin1')
```

## ¿Qué devuelve `cargar_datos`? (I)

- El output de esta función es una lista que se define con clase `datos_gob_es`. Esta lista contiene dos slots:

1\. Los datos (si pudieron ser leídos).

```{r}
head(elections$data[[1]], 5)
```

## ¿Qué devuelve `cargar_datos`? (II)

2\. Metadata relativa a los mismos.

```{r}
elections$metadata
```



